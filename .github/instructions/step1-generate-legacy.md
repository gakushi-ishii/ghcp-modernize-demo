---
title: "Step 1: レガシーアプリ生成ルール"
description: "Copilot がレガシー言語のアプリを生成する際のガイドライン（言語不問）"
applyTo: "workspace/legacy/**"
excludeAgent: "code-review"
---

# Step 1: レガシーアプリ生成ルール

このインストラクションは、GitHub Copilot がレガシーアプリを生成する際のガードレールです。
**どの言語を選択しても**、デモ環境で確実に動作し、後のモダナイズ（Step 2）につなげやすいコードを生成させることを目的としています。

---

## 前提条件

> **❗ このデモは Windows OS（WSL なし）を前提としています。**
> 
> エージェントによる動作確認は、Windows 標準の `cmd.exe` および `powershell.exe` で実行可能な言語のみ対応します。

---

## 環境制約（言語不問）

以下の制約は COBOL、VB6、Perl、FORTRAN など **あらゆるレガシー言語に適用** されます：

- **データベース不使用** — ファイルベース（CSV, JSON, 固定長テキスト等）で永続化する
- **外部 API 不使用** — ネットワーク通信なし
- **追加ミドルウェア不使用** — 言語標準のランタイムのみで動作
- **OS 固有機能を避ける** — クロスプラットフォーム対応（できるだけ）
- **外部パッケージ最小限** — 言語の標準ライブラリ範囲で実装

---

## 言語別の実行環境について（Windows 前提）

レガシー言語は実行環境が限られるため、エージェントによる自動動作確認が**できる言語とできない言語**があります。

### ✅ エージェントが動作確認**可能**な言語（Windows 標準環境）

以下の言語は、Windows に標準搭載のランタイムで実行可能なため、エージェントが動作確認を試みます：

| 言語 | 実行コマンド例 | ランタイム |
|------|--------------|----------|
| **VBScript** | `cscript //NoLogo script.vbs` | Windows 標準 (`cscript.exe`) |
| **Batch Script** | `script.bat` または `cmd /c script.bat` | Windows 標準 (`cmd.exe`) |
| **JScript** | `cscript //NoLogo script.js` | Windows 標準 (`cscript.exe`) |
| **PowerShell** | `powershell -File script.ps1` | Windows 標準 (`powershell.exe`) |

### ⚠️ エージェントが動作確認**困難**な言語（追加インストールが必要）

以下の言語は、追加のランタイムやコンパイラが必要なため、エージェントによる自動動作確認は**スキップ**されます：

| 言語 | 必要な環境 | 代替確認方法 |
|------|----------|------------|
| **COBOL** | GnuCOBOL (`cobc`) | 構文チェック・ドキュメント検証 |
| **VB6** | VB6 IDE/ランタイム | 構文チェック・ドキュメント検証 |
| **FORTRAN** | gfortran | 構文チェック・ドキュメント検証 |
| **Perl** | Strawberry Perl 等 | 構文チェック・ドキュメント検証 |
| **RPG** | IBM i 環境 | 構文チェック・ドキュメント検証 |
| **PL/I** | 専用コンパイラ | 構文チェック・ドキュメント検証 |

### 動作確認ができない場合の代替検証

実行環境がない言語の場合、以下の方法で品質を担保します：

1. **構文の妥当性確認** — 言語仕様に沿った正しい構文か
2. **ドキュメントの完全性** — `specification.md` でロジックが明確に記述されているか
3. **サンプルデータの整合性** — 入力データと期待される出力が一致するか
4. **コードレビュー観点での確認** — 命名規則、コメント、モジュール構成

---

## アプリケーション設計

- **CLI アプリケーション** として実装（GUI・Web UI は不要）
- **サンプルデータ必須** — クローン直後に動作確認できる状態に
- **ビジネスロジック必須** — 計算処理・バリデーション・条件分岐を最低 2～3 個含める
- **1 ファイル 300 行以内** に収める（読みやすく、Step 2 で変換しやすく）
- **関数・サブルーチン単位** でモジュール化
- **メイン処理フローが明確** に構成

## 出力先・ディレクトリ構成

```
workspace/legacy/
├── <main-source-file>    # 言語によって異なる (*.cbl, *.bas, *.pl 等)
├── data/                 # サンプルデータファイル
│   └── *.csv (or *.json, *.txt)
├── output/               # 実行結果の出力先（初期は空）
└── docs/
    ├── how-to-run.md     # 実行手順
    └── specification.md  # 入出力仕様・ビジネスロジック
```

## ドキュメント生成（必須）

### `how-to-run.md` — 動作確認手順

言語ごとに異なるため、以下を記載：

- 必要な環境・ランタイムのバージョン
- インストール手順（言語系ツール）
- ビルド手順（必要な場合）
- 実行コマンド（実行例を含める）
- 期待される出力結果の例

### `specification.md` — 入出力仕様・ビジネスロジック

以下を記載：

- **入力ファイルの形式** — カラム定義、データ型、サンプル
- **出力結果の形式** — カラム定義、データ型、サンプル
- **ビジネスロジック** — 計算式、条件判定、閾値等の詳細

## コード品質

- **日本語でコメント記載** — 言語の標準に従った形式で
- **命名規則** — 言語の慣習に従う（COBOL なら大文字、VB なら PascalCase 等）
- **エラーハンドリング** — 最低限のチェック（ファイル存在確認など）
- **出力フォーマット** — CSV・JSON・テキスト形式を明確に

---

## チェックリスト

生成後、以下を確認してください：

- [ ] `workspace/legacy/docs/how-to-run.md` が存在し、実行手順が明確
- [ ] `workspace/legacy/docs/specification.md` が存在し、入出力仕様が記載
- [ ] `workspace/legacy/data/` にサンプルデータが含まれている
- [ ] ソースコードに日本語コメントが含まれている
- [ ] **動作確認**（以下のいずれか）：
  - ✅ 実行可能な言語の場合：実際にコマンドを実行して動作確認
  - ⚠️ 実行困難な言語の場合：構文・ドキュメント・データ整合性を検証

---

## エージェント向け：動作確認の判断基準

**動作確認を試みる前に、以下の手順で判断してください：**

1. 生成した言語が「実行可能な言語」リストに含まれるか確認
2. 含まれる場合 → `run_in_terminal` で実行を試みる
3. 含まれない場合 → 代替検証（構文・ドキュメント・データ整合性）を実施
4. 実行を試みてエラーが出た場合 → エラー内容を `how-to-run.md` に追記し、ユーザーに環境準備を促す

**実行できない場合のメッセージ例：**
```
⚠️ この言語（COBOL）は Windows 標準環境では実行できません。
生成されたコードの動作確認は、以下の環境を準備して手動で行ってください：
- GnuCOBOL (cobc) をインストール
- 詳細は docs/how-to-run.md を参照
```
