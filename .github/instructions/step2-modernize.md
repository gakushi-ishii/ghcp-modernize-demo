---
applyTo: "workspace/modern/work/**"
---

# Step 2: モダナイズルール（TDD ガードレール）

このインストラクションは `workspace/modern/work/` で作業する際に自動適用されます。
共通制約（環境制約、エンコーディング）は `.github/copilot-instructions.md` を参照してください。

---

## 🔴 テスト駆動開発（TDD）の徹底

> **必ずテストを先に作成すること。コードを書く前にテストを書く。**

### TDD のルール

1. **テストファースト** — 実装コードを書く前に、必ずテストを先に作成
2. **仕様ベース** — レガシーコードの `specification.md` に基づいてテストを設計
3. **全ロジックをカバー** — すべてのビジネスロジックに対するユニットテストを含める
4. **テストパス確認** — テストが全てパスすることを確認してからコード完成

### テストケースに含める内容

- **正常系テスト** — 期待通りの入力に対する出力
- **異常系テスト** — 不正な入力、境界値、エラーケース
- **エッジケース** — 空データ、大量データ等

### テストフレームワーク

| 言語 | フレームワーク |
|------|---------------|
| Python | pytest |
| Java | JUnit |
| TypeScript | Jest |
| Go | testing パッケージ |
| C# | xUnit / NUnit |

### 🐍 Python の場合：仮想環境の使用（必須）

Python でモダナイズする場合、**必ず仮想環境（venv）を作成して使用すること**。

仮想環境を使用する理由：
- システムの Python 環境を汚染しない
- プロジェクトごとに依存関係を分離
- 再現性のある環境構築が可能

---

## 移行方針

- **入出力互換性を保証** — レガシーコードの入出力仕様を変更しない
- **同じ結果を保証** — 同じサンプルデータで同じ結果が得られること
- **段階的移行** — 関数単位で段階的に移行
- **モダンな慣習に従う** — 移行先言語のベストプラクティスに従う

---

## 出力先・ディレクトリ構成

**言語ごとにサブディレクトリを作成すること。**

初期状態では `workspace/modern/work/` までが存在し、モダナイズ依頼時に言語ディレクトリを作成する。

```
workspace/modern/work/
├── python/            # Python でモダナイズする場合
│   ├── src/
│   ├── tests/
│   ├── data/
│   ├── docs/
│   └── .venv/         # Python 仮想環境
├── typescript/        # TypeScript でモダナイズする場合
│   ├── src/
│   ├── tests/
│   ├── data/
│   └── docs/
├── java/              # Java でモダナイズする場合
│   ├── src/main/java/
│   ├── src/test/java/
│   ├── data/
│   └── docs/
├── csharp/            # C# でモダナイズする場合
└── go/                # Go でモダナイズする場合
```

### 言語別の出力先ルール

| 言語 | 出力先 | ソース | テスト | データ | ドキュメント |
|------|--------|--------|--------|--------|--------------|
| Python | `work/python/` | `src/` | `tests/` | `data/` | `docs/` |
| TypeScript | `work/typescript/` | `src/` | `tests/` | `data/` | `docs/` |
| Java | `work/java/` | `src/main/java/` | `src/test/java/` | `data/` | `docs/` |
| C# | `work/csharp/` | `src/` | `tests/` | `data/` | `docs/` |
| Go | `work/go/` | `./` または `internal/` | `./*_test.go` | `data/` | `docs/` |

**共通ルール:**
- `data/` — レガシーからコピー/変換したサンプルデータファイル（CSV 等）
- `docs/how-to-run.md` — 実行手順・テスト手順（必須）

---

## ドキュメント生成（必須）

### `how-to-run.md`

- 必要な環境・ランタイムのバージョン
- 依存パッケージのインストール手順
- **テストの実行コマンド**
- アプリケーション実行コマンド
- 期待される出力結果の例

---

## コード品質

- **型ヒント・型注釈** を積極的に使用
- **データクラス・DTO** を適切に活用
- **エラーハンドリング** を適切に実装
- **日本語コメント** を適切に記載
- **命名規則** は移行先言語の標準に従う

---

## チェックリスト

- [ ] `workspace/modern/work/<言語名>/` ディレクトリが作成されている
- [ ] 出力先ルールに従ってディレクトリやファイルが存在している。
- [ ] **テストが全てパスしている**
- [ ] `how-to-run.md` にテスト・実行手順が記載
- [ ] レガシー版と同じサンプルデータで同じ結果が得られる
- [ ] ソースコードに日本語コメントが含まれている
