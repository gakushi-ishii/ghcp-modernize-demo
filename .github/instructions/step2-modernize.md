---
title: "Step 2: モダナイズルール（TDD ガードレール）"
description: "Copilot がレガシーコードをモダナイズする際のガイドライン（言語不問）"
applyTo: "workspace/modern/**"
excludeAgent: "code-review"
---

# Step 2: モダナイズルール（TDD ガードレール）

このインストラクションは、GitHub Copilot がレガシーコードをモダナイズする際のガードレールです。
**どの言語を移行先に指定しても**、テスト駆動開発（TDD）を強制し、既存仕様を確実に保持したまま移行を行うことを目的としています。

---

## テスト駆動開発（TDD）の徹底

- **コードを書く前に、必ずテストを先に作成すること**
- レガシーコードの入出力仕様（`workspace/legacy/docs/specification.md`）に基づいてテストを設計すること
- 全てのビジネスロジックに対するユニットテストを含めること
- テストケースには以下を含めること：
  - 正常系テスト（期待通りの入力に対する出力）
  - 異常系テスト（不正な入力、境界値、エラーケース）
  - エッジケース（空データ、大量データ等）
- テストが全てパスすることを確認してからコードを完成とすること
- テストフレームワークは言語の標準的なものを使用すること（例: Python → pytest, Java → JUnit, TypeScript → Jest）

## 移行方針

- **入出力互換性を保証** — レガシーコードの入出力仕様を変更しない
- **同じ結果を保証** — 同じサンプルデータで同じ結果が得られること
- **段階的移行** — 関数単位で段階的に移行（一度に全体を書き換えない）
- **モダンな慣習に従う** — 移行先言語の習慣・ベストプラクティスに従う
- **外部依存は Step 1 と同様** — DB 不使用、ネットワーク不使用

## 出力先・ディレクトリ構成

```
workspace/modern/
├── src/               # ソースコード（言語別の構造）
├── tests/             # テストコード
├── data/              # サンプルデータファイル（レガシーからコピー/変換）
├── output/            # 実行結果の出力先
└── docs/
    ├── how-to-run.md  # 実行手順・テスト手順
    └── spec-comparison.md  # （オプション）レガシーとの仕様比較
```

## ドキュメント生成（必須）

### `how-to-run.md` — 動作確認手順

移行先言語に応じて以下を記載：

- 必要な環境・ランタイムのバージョン
- 依存パッケージのインストール手順（pip, npm, Maven など）
- テストの実行コマンド
- テストの期待される結果
- アプリケーション実行コマンド
- 期待される出力結果の例

## コード品質

- **型ヒント・型注釈** を積極的に使用（Java なら @Nullable など、Python なら type hints など）
- **データクラス・DTO** を適切に活用
- **エラーハンドリング** を適切に実装
- **日本語コメント** を適切に記載
- **命名規則** は移行先言語の標準に従う（Java なら camelCase, Go なら PascalCase など）

---

## チェックリスト

生成後、以下を確認してください：

- [ ] `workspace/modern/tests/` にテストコードが存在
- [ ] `workspace/modern/src/` にモダン言語コードが存在
- [ ] テストが全てパスしている
- [ ] `workspace/modern/docs/how-to-run.md` にテスト・実行手順が記載
- [ ] レガシー版と同じサンプルデータで同じ結果が得られる
- [ ] ソースコードに日本語コメントが含まれている
