---
applyTo: "workspace/modern/work/**"
---

# Step 2: モダナイズルール（TDD ガードレール）

このインストラクションは `workspace/modern/work/` で作業する際に自動適用されます。
共通制約（環境制約、エンコーディング）は `.github/copilot-instructions.md` を参照してください。

---

## 🔴 テスト駆動開発（TDD）の徹底

> **必ずテストを先に作成すること。コードを書く前にテストを書く。**

### TDD のルール

1. **テストファースト** — 実装コードを書く前に、必ずテストを先に作成
2. **仕様ベース** — レガシーコードの `specification.md` に基づいてテストを設計
3. **全ロジックをカバー** — すべてのビジネスロジックに対するユニットテストを含める
4. **テストパス確認** — テストが全てパスすることを確認してからコード完成

### テストケースに含める内容

- **正常系テスト** — 期待通りの入力に対する出力
- **異常系テスト** — 不正な入力、境界値、エラーケース
- **エッジケース** — 空データ、大量データ等

### テストフレームワーク

| 言語 | フレームワーク |
|------|---------------|
| Python | pytest |
| Java | JUnit |
| TypeScript | Jest |
| Go | testing パッケージ |
| C# | xUnit / NUnit |

---

## 移行方針

- **入出力互換性を保証** — レガシーコードの入出力仕様を変更しない
- **同じ結果を保証** — 同じサンプルデータで同じ結果が得られること
- **段階的移行** — 関数単位で段階的に移行
- **モダンな慣習に従う** — 移行先言語のベストプラクティスに従う

---

## 出力先・ディレクトリ構成

```
workspace/modern/work/
├── src/               # ソースコード
├── tests/             # テストコード
├── data/              # サンプルデータファイル（レガシーからコピー/変換）
└── docs/
    └── how-to-run.md  # 実行手順・テスト手順
```

---

## ドキュメント生成（必須）

### `how-to-run.md`

- 必要な環境・ランタイムのバージョン
- 依存パッケージのインストール手順
- **テストの実行コマンド**
- アプリケーション実行コマンド
- 期待される出力結果の例

---

## コード品質

- **型ヒント・型注釈** を積極的に使用
- **データクラス・DTO** を適切に活用
- **エラーハンドリング** を適切に実装
- **日本語コメント** を適切に記載
- **命名規則** は移行先言語の標準に従う

---

## チェックリスト

- [ ] `workspace/modern/work/tests/` にテストコードが存在
- [ ] `workspace/modern/work/src/` にモダン言語コードが存在
- [ ] **テストが全てパスしている**
- [ ] `workspace/modern/work/docs/how-to-run.md` にテスト・実行手順が記載
- [ ] レガシー版と同じサンプルデータで同じ結果が得られる
- [ ] ソースコードに日本語コメントが含まれている
